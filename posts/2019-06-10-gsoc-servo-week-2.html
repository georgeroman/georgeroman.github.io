<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>georgeroman - GSoC with Servo - week 2</title>
        <link rel="stylesheet" href="../css/default.css" />
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">George's blog</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../about.html">About</a>
                <a href="../contact.html">Contact</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>GSoC with Servo - week 2</h1>
            <article>
    <section class="header">
        Posted on June 10, 2019
        
            by George Roman
        
    </section>
    <section>
        <p>The previous week I was mainly concerned with fixing the common <a href="https://github.com/servo/servo/issues/23535">error</a> in the wdspec tests, since it was blocking the progress in enabling the WebDriver tests.</p>
<p>The error originated in <a href="https://github.com/servo/servo/blob/4c776f33d407c1ef84952967925318476ac9e3f6/tests/wpt/web-platform-tests/webdriver/tests/get_current_url/get.py#L17"><code>test_no_browsing_context</code></a>, present in almost all wdspec tests. Since this is the first test to be run for the majority of the commands and since the WebDriver server panicked due to the error it triggered, all the next tests were failing since they were trying to connect to the failed WebDriver server instance.</p>
<p>The <code>test_no_browsing_context</code> test attempts to create a new window by means of the <code>Execute Script</code> command with a <code>window.open()</code> argument. But creating a new window needs a mutable borrow of <a href="https://github.com/servo/servo/blob/8f11b52d9a80a51ddf80212817b87efc20bef8d6/components/script/script_thread.rs#L2964-L2966"><code>documents</code></a> in the current script thread. This is why the <code>DomRefCell&lt;T&gt; already borrowed</code> error occured and it happened because <code>documents</code> was already immutably borrowed in <a href="https://github.com/servo/servo/blob/4c776f33d407c1ef84952967925318476ac9e3f6/components/script/script_thread.rs#L1837"><code>handle_webdriver_msg</code></a>. Fixing this required <a href="https://github.com/servo/servo/pull/23544">special treatment</a> in handling the <code>ExecuteScript</code> and <code>ExecuteAsyncScript</code> WebDriver messages.</p>
<p>Last week, the <code>new_session</code> tests were finally <a href="https://github.com/servo/servo/pull/23443">enabled</a> in Servo, together with a compliant implementation of the <code>New Session</code> command. However, this happened with some delay due to an <a href="https://github.com/web-platform-tests/wpt/issues/17210">issue</a> in the <code>wpt</code> test runner, which I addressed with a quick <a href="https://github.com/web-platform-tests/wpt/pull/17212">fix</a>.</p>
<p>I also worked on adding different missing pieces in the implementation of some WebDriver commands which will be needed when the rest of the wdspec tests will to be enabled.</p>
<p>In the third week Iâ€™m planning to enable the wdspec tests for the commands that our WebDriver implementation supports and also revise their implementation where needed.</p>
<p>This week was not very productive in terms of achieved results, as I mostly did debugging and analysed where things could be going wrong. But this got me a better understanding of how things are working under the hood and it was a necessary preparation for the next steps.</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>
</html>
