{"title":"GSoC with Servo - week 2","date":"2019-06-10T00:00:00.000Z","slug":"gsoc-with-servo-week-2","html":"\n<p>The previous week I was mainly concerned with fixing the common <a href=\"https://github.com/servo/servo/issues/23535\">error</a> in the <code>wdspec</code> tests,\nsince it was blocking the progress in enabling the WebDriver tests.</p>\n<p>The error originated in <a href=\"https://github.com/servo/servo/blob/4c776f33d407c1ef84952967925318476ac9e3f6/tests/wpt/web-platform-tests/webdriver/tests/get_current_url/get.py#L17\"><code>test_no_browsing_context</code></a>,\npresent in almost all <code>wdspec</code> tests.\nSince this is the first test to be run for the majority of the commands and since the WebDriver server panicked due to the error it triggered, all the next tests were failing since\nthey were trying to connect to the failed WebDriver server instance.</p>\n<p>The <code>test_no_browsing_context</code> test attempts to create a new window by means of the <code>Execute Script</code> command with a <code>window.open()</code> argument.\nBut creating a new window needs a mutable borrow of <a href=\"https://github.com/servo/servo/blob/8f11b52d9a80a51ddf80212817b87efc20bef8d6/components/script/script_thread.rs#L2964-L2966\"><code>documents</code></a>\nin the current script thread.\nThis is why the <code>DomRefCell&lt;T&gt; already borrowed</code> error occured and it happened because <code>documents</code> was already immutably borrowed in\n<a href=\"https://github.com/servo/servo/blob/4c776f33d407c1ef84952967925318476ac9e3f6/components/script/script_thread.rs#L1837\"><code>handle_webdriver_msg</code></a>.\nFixing this required <a href=\"https://github.com/servo/servo/pull/23544\">special treatment</a> in handling the <code>ExecuteScript</code> and <code>ExecuteAsyncScript</code> WebDriver messages.</p>\n<p>Last week, the <code>new_session</code> tests were finally <a href=\"https://github.com/servo/servo/pull/23443\">enabled</a> in Servo, together with a compliant implementation of the <code>New Session</code> command.\nHowever, this happened with some delay due to an <a href=\"https://github.com/web-platform-tests/wpt/issues/17210\">issue</a> in the <code>wpt</code> test runner, which I addressed with a quick <a href=\"https://github.com/web-platform-tests/wpt/pull/17212\">fix</a>.</p>\n<p>I also worked on adding different missing pieces in the implementation of some WebDriver commands which will be needed when the rest of the <code>wdspec</code> tests will to be enabled.</p>\n<p>In the third week I'm planning to enable the <code>wdspec</code> tests for the commands that our WebDriver implementation supports and also revise their implementation where needed.</p>\n<p>This week was not very productive in terms of achieved results, as I mostly did debugging and analysed where things could be going wrong.\nBut this got me a better understanding of how things are working under the hood and it was a necessary preparation for the next steps.</p>\n"}