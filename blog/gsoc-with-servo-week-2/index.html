<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=global.css rel=stylesheet> <link href=favicon.png rel=icon type=image/png> <noscript id=sapper-head-start></noscript><title>GSoC with Servo - week 2</title><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <main> <div class=siimple-content--medium><div class="siimple--mx-4 siimple--my-4"><div class=siimple-h3>GSoC with Servo - week 2</div> <div> <p>The previous week I was mainly concerned with fixing the common <a href=https://github.com/servo/servo/issues/23535>error</a> in the <code>wdspec</code> tests, since it was blocking the progress in enabling the WebDriver tests.</p> <p>The error originated in <a href=https://github.com/servo/servo/blob/4c776f33d407c1ef84952967925318476ac9e3f6/tests/wpt/web-platform-tests/webdriver/tests/get_current_url/get.py#L17><code>test_no_browsing_context</code></a>, present in almost all <code>wdspec</code> tests. Since this is the first test to be run for the majority of the commands and since the WebDriver server panicked due to the error it triggered, all the next tests were failing since they were trying to connect to the failed WebDriver server instance.</p> <p>The <code>test_no_browsing_context</code> test attempts to create a new window by means of the <code>Execute Script</code> command with a <code>window.open()</code> argument. But creating a new window needs a mutable borrow of <a href=https://github.com/servo/servo/blob/8f11b52d9a80a51ddf80212817b87efc20bef8d6/components/script/script_thread.rs#L2964-L2966><code>documents</code></a> in the current script thread. This is why the <code>DomRefCell&lt;T> already borrowed</code> error occured and it happened because <code>documents</code> was already immutably borrowed in <a href=https://github.com/servo/servo/blob/4c776f33d407c1ef84952967925318476ac9e3f6/components/script/script_thread.rs#L1837><code>handle_webdriver_msg</code></a>. Fixing this required <a href=https://github.com/servo/servo/pull/23544>special treatment</a> in handling the <code>ExecuteScript</code> and <code>ExecuteAsyncScript</code> WebDriver messages.</p> <p>Last week, the <code>new_session</code> tests were finally <a href=https://github.com/servo/servo/pull/23443>enabled</a> in Servo, together with a compliant implementation of the <code>New Session</code> command. However, this happened with some delay due to an <a href=https://github.com/web-platform-tests/wpt/issues/17210>issue</a> in the <code>wpt</code> test runner, which I addressed with a quick <a href=https://github.com/web-platform-tests/wpt/pull/17212>fix</a>.</p> <p>I also worked on adding different missing pieces in the implementation of some WebDriver commands which will be needed when the rest of the <code>wdspec</code> tests will to be enabled.</p> <p>In the third week I'm planning to enable the <code>wdspec</code> tests for the commands that our WebDriver implementation supports and also revise their implementation where needed.</p> <p>This week was not very productive in terms of achieved results, as I mostly did debugging and analysed where things could be going wrong. But this got me a better understanding of how things are working under the hood and it was a necessary preparation for the next steps.</p> </div></div></div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"GSoC with Servo - week 2",date:"2019-06-10T00:00:00.000Z",slug:"gsoc-with-servo-week-2",html:"\n\u003Cp\u003EThe previous week I was mainly concerned with fixing the common \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fissues\u002F23535\"\u003Eerror\u003C\u002Fa\u003E in the \u003Ccode\u003Ewdspec\u003C\u002Fcode\u003E tests,\nsince it was blocking the progress in enabling the WebDriver tests.\u003C\u002Fp\u003E\n\u003Cp\u003EThe error originated in \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fblob\u002F4c776f33d407c1ef84952967925318476ac9e3f6\u002Ftests\u002Fwpt\u002Fweb-platform-tests\u002Fwebdriver\u002Ftests\u002Fget_current_url\u002Fget.py#L17\"\u003E\u003Ccode\u003Etest_no_browsing_context\u003C\u002Fcode\u003E\u003C\u002Fa\u003E,\npresent in almost all \u003Ccode\u003Ewdspec\u003C\u002Fcode\u003E tests.\nSince this is the first test to be run for the majority of the commands and since the WebDriver server panicked due to the error it triggered, all the next tests were failing since\nthey were trying to connect to the failed WebDriver server instance.\u003C\u002Fp\u003E\n\u003Cp\u003EThe \u003Ccode\u003Etest_no_browsing_context\u003C\u002Fcode\u003E test attempts to create a new window by means of the \u003Ccode\u003EExecute Script\u003C\u002Fcode\u003E command with a \u003Ccode\u003Ewindow.open()\u003C\u002Fcode\u003E argument.\nBut creating a new window needs a mutable borrow of \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fblob\u002F8f11b52d9a80a51ddf80212817b87efc20bef8d6\u002Fcomponents\u002Fscript\u002Fscript_thread.rs#L2964-L2966\"\u003E\u003Ccode\u003Edocuments\u003C\u002Fcode\u003E\u003C\u002Fa\u003E\nin the current script thread.\nThis is why the \u003Ccode\u003EDomRefCell&lt;T&gt; already borrowed\u003C\u002Fcode\u003E error occured and it happened because \u003Ccode\u003Edocuments\u003C\u002Fcode\u003E was already immutably borrowed in\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fblob\u002F4c776f33d407c1ef84952967925318476ac9e3f6\u002Fcomponents\u002Fscript\u002Fscript_thread.rs#L1837\"\u003E\u003Ccode\u003Ehandle_webdriver_msg\u003C\u002Fcode\u003E\u003C\u002Fa\u003E.\nFixing this required \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23544\"\u003Especial treatment\u003C\u002Fa\u003E in handling the \u003Ccode\u003EExecuteScript\u003C\u002Fcode\u003E and \u003Ccode\u003EExecuteAsyncScript\u003C\u002Fcode\u003E WebDriver messages.\u003C\u002Fp\u003E\n\u003Cp\u003ELast week, the \u003Ccode\u003Enew_session\u003C\u002Fcode\u003E tests were finally \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23443\"\u003Eenabled\u003C\u002Fa\u003E in Servo, together with a compliant implementation of the \u003Ccode\u003ENew Session\u003C\u002Fcode\u003E command.\nHowever, this happened with some delay due to an \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fweb-platform-tests\u002Fwpt\u002Fissues\u002F17210\"\u003Eissue\u003C\u002Fa\u003E in the \u003Ccode\u003Ewpt\u003C\u002Fcode\u003E test runner, which I addressed with a quick \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fweb-platform-tests\u002Fwpt\u002Fpull\u002F17212\"\u003Efix\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EI also worked on adding different missing pieces in the implementation of some WebDriver commands which will be needed when the rest of the \u003Ccode\u003Ewdspec\u003C\u002Fcode\u003E tests will to be enabled.\u003C\u002Fp\u003E\n\u003Cp\u003EIn the third week I'm planning to enable the \u003Ccode\u003Ewdspec\u003C\u002Fcode\u003E tests for the commands that our WebDriver implementation supports and also revise their implementation where needed.\u003C\u002Fp\u003E\n\u003Cp\u003EThis week was not very productive in terms of achieved results, as I mostly did debugging and analysed where things could be going wrong.\nBut this got me a better understanding of how things are working under the hood and it was a necessary preparation for the next steps.\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.e5726ad4.js"}catch(e){main="/client/legacy/client.326a6068.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 