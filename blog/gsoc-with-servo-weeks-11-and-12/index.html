<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=global.css rel=stylesheet> <link href=favicon.png rel=icon type=image/png> <noscript id=sapper-head-start></noscript><title>GSoC with Servo - weeks 11 and 12</title><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <main> <div class=siimple-content--medium><div class="siimple--mx-4 siimple--my-4"><div class=siimple-h3>GSoC with Servo - weeks 11 and 12</div> <div> <p>Weeks 11 and 12 have been quite productive, with a good amount of new features added to WebDriver.</p> <p>One new command that got <a href=https://github.com/servo/servo/pull/23943>implemented</a> last week is <a href=https://w3c.github.io/webdriver/#take-element-screenshot><code>TakeElementScreenshot</code></a>. Although it's very similar to <a href=https://w3c.github.io/webdriver/#take-screenshot><code>TakeScreenshot</code></a> in terms of implementation, it needed some additional small tweaks in order to work properly.</p> <p>The core functionality of both of these commands is offered by <a href=https://github.com/servo/servo/blob/fb5a12159a2f7e84ac2470952078a4dafa3ce28e/components/compositing/gl.rs#L82><code>draw_img</code></a> which, as the name implies, encodes part (a rectangle) of the frame buffer into an image. Before, <a href=https://github.com/servo/servo/blob/fb5a12159a2f7e84ac2470952078a4dafa3ce28e/components/compositing/gl.rs#L82><code>draw_img</code></a> expected that rectangle to always start at point <code>(0, 0)</code>. But for <a href=https://w3c.github.io/webdriver/#take-element-screenshot><code>TakeElementScreenshot</code></a> the screenshotted rectangle could start anywhere in the viewport, not necessarily at that point. This was easily addressed, but it was not all I needed. One more thing that was needed was the conversion between an element's rectangle top left corner coordinates to its down left corner coordinates used by OpenGL. Basically, the <code>y</code> coordinate required conversion using a simple formula:</p> <p><code>down_left_y = viewport_height - top_left_y - rect_height</code></p> <p>Another new thing that I did last week was <a href=https://github.com/servo/servo/pull/23951>change</a> the communication between the WebDriver server and the browser to have it possible to propagate error codes between the two. This was an easy change, but it involved a lot of additional small changes. At this step I also added proper distinction between <a href=https://w3c.github.io/webdriver/#dfn-is-stale>stale</a> and inexistent elements. This involved keeping track of all the nodes ever created in the current <a href=https://github.com/servo/servo/blob/fb5a12159a2f7e84ac2470952078a4dafa3ce28e/components/script/script_thread.rs#L521><code>ScriptThread</code></a> and then use this information in <a href=https://github.com/servo/servo/blob/fb5a12159a2f7e84ac2470952078a4dafa3ce28e/components/script/webdriver_handlers.rs#L57><code>find_node_by_unique_id</code></a>.</p> <p>The work on <a href=https://web-platform-tests.org/writing-tests/testdriver.html>testdriver.js</a> got blocked by a <a href=https://github.com/servo/webrender/issues/3739>strange panick</a>. At a first glance, this has an easy fix but, since I'm not very familiar with <a href=https://github.com/servo/webrender><code>webrender</code></a>, I'm not sure if it's the right fix or not. Fortunately, I've managed to patch my own version of <a href=https://github.com/servo/webrender><code>webrender</code></a> so I can continue working on <a href=https://web-platform-tests.org/writing-tests/testdriver.html>testdriver.js</a> without getting into this failure again.</p> <p>There is only one more week left of GSoC, twelve weeks have passed so quickly! In the last week I'm planning to wrap up the awaiting pull requests (<a href=https://github.com/servo/servo/pull/23996><code>pointerMove</code></a> WebDriver action and <a href=https://github.com/servo/servo/pull/23947>final additions</a> to the <code>JSON</code> clone algorithm) and continue working on the <a href=https://github.com/servo/servo/pull/23947>testdriver.js</a>.</p> </div></div></div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"GSoC with Servo - weeks 11 and 12",date:"2019-08-19T00:00:00.000Z",slug:"gsoc-with-servo-weeks-11-and-12",html:"\n\u003Cp\u003EWeeks 11 and 12 have been quite productive, with a good amount of new features added to WebDriver.\u003C\u002Fp\u003E\n\u003Cp\u003EOne new command that got \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23943\"\u003Eimplemented\u003C\u002Fa\u003E last week is \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#take-element-screenshot\"\u003E\u003Ccode\u003ETakeElementScreenshot\u003C\u002Fcode\u003E\u003C\u002Fa\u003E.\nAlthough it's very similar to \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#take-screenshot\"\u003E\u003Ccode\u003ETakeScreenshot\u003C\u002Fcode\u003E\u003C\u002Fa\u003E in terms of implementation, it needed some additional small tweaks in order to work properly.\u003C\u002Fp\u003E\n\u003Cp\u003EThe core functionality of both of these commands is offered by \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fblob\u002Ffb5a12159a2f7e84ac2470952078a4dafa3ce28e\u002Fcomponents\u002Fcompositing\u002Fgl.rs#L82\"\u003E\u003Ccode\u003Edraw_img\u003C\u002Fcode\u003E\u003C\u002Fa\u003E which,\nas the name implies, encodes part (a rectangle) of the frame buffer into an image.\nBefore, \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fblob\u002Ffb5a12159a2f7e84ac2470952078a4dafa3ce28e\u002Fcomponents\u002Fcompositing\u002Fgl.rs#L82\"\u003E\u003Ccode\u003Edraw_img\u003C\u002Fcode\u003E\u003C\u002Fa\u003E expected that rectangle to always start at point \u003Ccode\u003E(0, 0)\u003C\u002Fcode\u003E.\nBut for \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#take-element-screenshot\"\u003E\u003Ccode\u003ETakeElementScreenshot\u003C\u002Fcode\u003E\u003C\u002Fa\u003E the screenshotted rectangle could start anywhere in the viewport, not necessarily at that point.\nThis was easily addressed, but it was not all I needed.\nOne more thing that was needed was the conversion between an element's rectangle top left corner coordinates to its down left corner coordinates used by OpenGL.\nBasically, the \u003Ccode\u003Ey\u003C\u002Fcode\u003E coordinate required conversion using a simple formula:\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode\u003Edown_left_y = viewport_height - top_left_y - rect_height\u003C\u002Fcode\u003E\u003C\u002Fp\u003E\n\u003Cp\u003EAnother new thing that I did last week was \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23951\"\u003Echange\u003C\u002Fa\u003E the communication between the WebDriver server and the browser to have it possible\nto propagate error codes between the two.\nThis was an easy change, but it involved a lot of additional small changes.\nAt this step I also added proper distinction between \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#dfn-is-stale\"\u003Estale\u003C\u002Fa\u003E and inexistent elements.\nThis involved keeping track of all the nodes ever created in the current\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fblob\u002Ffb5a12159a2f7e84ac2470952078a4dafa3ce28e\u002Fcomponents\u002Fscript\u002Fscript_thread.rs#L521\"\u003E\u003Ccode\u003EScriptThread\u003C\u002Fcode\u003E\u003C\u002Fa\u003E and then use this information in\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fblob\u002Ffb5a12159a2f7e84ac2470952078a4dafa3ce28e\u002Fcomponents\u002Fscript\u002Fwebdriver_handlers.rs#L57\"\u003E\u003Ccode\u003Efind_node_by_unique_id\u003C\u002Fcode\u003E\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003EThe work on \u003Ca href=\"https:\u002F\u002Fweb-platform-tests.org\u002Fwriting-tests\u002Ftestdriver.html\"\u003Etestdriver.js\u003C\u002Fa\u003E got blocked by a \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fwebrender\u002Fissues\u002F3739\"\u003Estrange panick\u003C\u002Fa\u003E.\nAt a first glance, this has an easy fix but, since I'm not very familiar with \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fwebrender\"\u003E\u003Ccode\u003Ewebrender\u003C\u002Fcode\u003E\u003C\u002Fa\u003E, I'm not sure if it's the right fix or not.\nFortunately, I've managed to patch my own version of \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fwebrender\"\u003E\u003Ccode\u003Ewebrender\u003C\u002Fcode\u003E\u003C\u002Fa\u003E so I can continue working on\n\u003Ca href=\"https:\u002F\u002Fweb-platform-tests.org\u002Fwriting-tests\u002Ftestdriver.html\"\u003Etestdriver.js\u003C\u002Fa\u003E without getting into this failure again.\u003C\u002Fp\u003E\n\u003Cp\u003EThere is only one more week left of GSoC, twelve weeks have passed so quickly! In the last week I'm planning to wrap up the awaiting pull requests\n(\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23996\"\u003E\u003Ccode\u003EpointerMove\u003C\u002Fcode\u003E\u003C\u002Fa\u003E WebDriver action and \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23947\"\u003Efinal additions\u003C\u002Fa\u003E to the \u003Ccode\u003EJSON\u003C\u002Fcode\u003E clone algorithm)\nand continue working on the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23947\"\u003Etestdriver.js\u003C\u002Fa\u003E.\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.e5726ad4.js"}catch(e){main="/client/legacy/client.326a6068.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 