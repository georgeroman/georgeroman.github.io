<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=global.css rel=stylesheet> <link href=favicon.png rel=icon type=image/png> <noscript id=sapper-head-start></noscript><title>GSoC with Servo - week 4</title><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <main> <div class=siimple-content--medium><div class="siimple--mx-4 siimple--my-4"><div class=siimple-h3>GSoC with Servo - week 4</div> <div> <p>Last week, the fourth week of GSoC, I worked on implementing some missing pieces of functionality and some new WebDriver commands. I also inspected some tests in the <code>wdspec</code> testing suite together with their status in order to identify possible common failures.</p> <p>These are the new commands that are now supported by Servo's WebDriver implementation: <a href=https://github.com/servo/servo/pull/23588><code>Status</code></a>, <a href=https://github.com/servo/servo/pull/23581><code>GetPageSource</code></a>, <a href=https://github.com/servo/servo/pull/23580><code>SwitchToWindow</code></a> (for now, only a single window is supported), <a href=https://github.com/servo/servo/pull/23580><code>DismissAlert</code></a> (currently, user alerts are not supported, so this is only a dummy implementation).</p> <p>Some new tests got enabled: <a href=https://github.com/web-platform-tests/wpt/tree/master/webdriver/tests/get_title><code>get_title</code></a> and <a href=https://github.com/web-platform-tests/wpt/tree/master/webdriver/tests/get_current_url><code>get_current_url</code></a>. These were previously disabled due to the fact that they triggered panics in the WebDriver server. It seems that this happened when the tests attempted to open a directory instead of a file. The <a href=https://github.com/servo/servo/pull/23593>solution</a> to this was pretty simple.</p> <p>Last week I also <a href=https://github.com/servo/servo/pull/23598>added</a> a filter for the intermittent failures in the <code>wdspec</code> testing suite so that these get reported in the same way as the failures in the other <code>wpt</code> tests.</p> <p>In addition to the previous work, I started to implement the <code>link text</code> and <code>partial link text</code> selector strategies for commands related to finding elements. While in the middle of it I realized that there is a missing piece of functionality that makes a lot of tests fail: the <a href=https://www.w3.org/TR/webdriver1/#dfn-internal-json-clone-algorithm><code>JSON</code> clone</a> algorithm.</p> <p>The <code>JSON</code> clone algorithm is mainly used by the <code>ExecuteScript</code> and <code>ExecuteAsyncScript</code> commands for returning JavaScript data to the WebDriver client. The current WebDriver implementation in Servo only supports primitive values as return values from JavaScript. But almost all of the tests that rely on <code>ExecuteScript</code> or <code>ExecuteAsyncScript</code> are expecting objects as return values. So, having it fully implemented would fix some existing tests and would reveal possible flaws that are directly related to the tested command.</p> <p>In the quest for it, I started with a JavaScript implementation but this got me nowhere since serializing <code>DOM</code> objects requires access to certain fields that are not accessible from JavaScript. So, I decided to go with a pure Rust implementation. This means that I need to deal with the <a href=https://doc.servo.org/mozjs/jsapi/struct.JSObject.html><code>JSObject</code></a> that represents an object from JavaScript.</p> <p>Although I've just started to work on this, I find it extremely interesting and rewarding. Diving deeper into the workings of Servo is a great way to gain a deeper understanding of how all the different components of the browser engine are gracefully working together.</p> <p>This week I'm planning to work on implementing the <code>JSON</code> clone algorithm and, once this gets done, to review the status of the tests that depend on it.</p> </div></div></div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"GSoC with Servo - week 4",date:"2019-06-25T00:00:00.000Z",slug:"gsoc-with-servo-week-4",html:"\n\u003Cp\u003ELast week, the fourth week of GSoC, I worked on implementing some missing pieces of functionality and some new WebDriver commands.\nI also inspected some tests in the \u003Ccode\u003Ewdspec\u003C\u002Fcode\u003E testing suite together with their status in order to identify possible common failures.\u003C\u002Fp\u003E\n\u003Cp\u003EThese are the new commands that are now supported by Servo's WebDriver implementation: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23588\"\u003E\u003Ccode\u003EStatus\u003C\u002Fcode\u003E\u003C\u002Fa\u003E,\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23581\"\u003E\u003Ccode\u003EGetPageSource\u003C\u002Fcode\u003E\u003C\u002Fa\u003E,\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23580\"\u003E\u003Ccode\u003ESwitchToWindow\u003C\u002Fcode\u003E\u003C\u002Fa\u003E (for now, only a single window is supported),\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23580\"\u003E\u003Ccode\u003EDismissAlert\u003C\u002Fcode\u003E\u003C\u002Fa\u003E (currently, user alerts are not supported, so this is only a dummy implementation).\u003C\u002Fp\u003E\n\u003Cp\u003ESome new tests got enabled: \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fweb-platform-tests\u002Fwpt\u002Ftree\u002Fmaster\u002Fwebdriver\u002Ftests\u002Fget_title\"\u003E\u003Ccode\u003Eget_title\u003C\u002Fcode\u003E\u003C\u002Fa\u003E and\n\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fweb-platform-tests\u002Fwpt\u002Ftree\u002Fmaster\u002Fwebdriver\u002Ftests\u002Fget_current_url\"\u003E\u003Ccode\u003Eget_current_url\u003C\u002Fcode\u003E\u003C\u002Fa\u003E.\nThese were previously disabled due to the fact that they triggered panics in the WebDriver server.\nIt seems that this happened when the tests attempted to open a directory instead of a file.\nThe \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23593\"\u003Esolution\u003C\u002Fa\u003E to this was pretty simple.\u003C\u002Fp\u003E\n\u003Cp\u003ELast week I also \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23598\"\u003Eadded\u003C\u002Fa\u003E a filter for the intermittent failures in the \u003Ccode\u003Ewdspec\u003C\u002Fcode\u003E testing suite so that\nthese get reported in the same way as the failures in the other \u003Ccode\u003Ewpt\u003C\u002Fcode\u003E tests.\u003C\u002Fp\u003E\n\u003Cp\u003EIn addition to the previous work, I started to implement the \u003Ccode\u003Elink text\u003C\u002Fcode\u003E and \u003Ccode\u003Epartial link text\u003C\u002Fcode\u003E selector strategies for commands related to finding elements.\nWhile in the middle of it I realized that there is a missing piece of functionality that makes a lot of tests fail:\nthe \u003Ca href=\"https:\u002F\u002Fwww.w3.org\u002FTR\u002Fwebdriver1\u002F#dfn-internal-json-clone-algorithm\"\u003E\u003Ccode\u003EJSON\u003C\u002Fcode\u003E clone\u003C\u002Fa\u003E algorithm.\u003C\u002Fp\u003E\n\u003Cp\u003EThe \u003Ccode\u003EJSON\u003C\u002Fcode\u003E clone algorithm is mainly used by the \u003Ccode\u003EExecuteScript\u003C\u002Fcode\u003E and \u003Ccode\u003EExecuteAsyncScript\u003C\u002Fcode\u003E commands for returning JavaScript data to the WebDriver client.\nThe current WebDriver implementation in Servo only supports primitive values as return values from JavaScript.\nBut almost all of the tests that rely on \u003Ccode\u003EExecuteScript\u003C\u002Fcode\u003E or \u003Ccode\u003EExecuteAsyncScript\u003C\u002Fcode\u003E are expecting objects as return values.\nSo, having it fully implemented would fix some existing tests and would reveal possible flaws that are directly related to the tested command.\u003C\u002Fp\u003E\n\u003Cp\u003EIn the quest for it, I started with a JavaScript implementation but this got me nowhere since serializing \u003Ccode\u003EDOM\u003C\u002Fcode\u003E objects requires access to certain fields that are not accessible from JavaScript.\nSo, I decided to go with a pure Rust implementation.\nThis means that I need to deal with the \u003Ca href=\"https:\u002F\u002Fdoc.servo.org\u002Fmozjs\u002Fjsapi\u002Fstruct.JSObject.html\"\u003E\u003Ccode\u003EJSObject\u003C\u002Fcode\u003E\u003C\u002Fa\u003E that represents an object from JavaScript.\u003C\u002Fp\u003E\n\u003Cp\u003EAlthough I've just started to work on this, I find it extremely interesting and rewarding.\nDiving deeper into the workings of Servo is a great way to gain a deeper understanding of how all the different components of the browser engine are gracefully working together.\u003C\u002Fp\u003E\n\u003Cp\u003EThis week I'm planning to work on implementing the \u003Ccode\u003EJSON\u003C\u002Fcode\u003E clone algorithm and, once this gets done, to review the status of the tests that depend on it.\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.e5726ad4.js"}catch(e){main="/client/legacy/client.326a6068.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 