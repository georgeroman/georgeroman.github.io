<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <base href=/ > <link href=global.css rel=stylesheet> <link href=favicon.png rel=icon type=image/png> <noscript id=sapper-head-start></noscript><title>GSoC with Servo - weeks 9 and 10</title><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <main> <div class=siimple-content--medium><div class="siimple--mx-4 siimple--my-4"><div class=siimple-h3>GSoC with Servo - weeks 9 and 10</div> <div> <p>Last two weeks' focus was on finishing implementing the WebDriver <a href=https://w3c.github.io/webdriver/#actions>actions</a> commands. These were the most challenging ones so far as there was no existing infrastructure in place as opposed to most of the other WebDriver commands. For the <a href=https://w3c.github.io/webdriver/#keyboard-actions>keyboard actions</a> most of the implementation was already provided by the <a href=https://docs.rs/keyboard-types/0.4.4/keyboard_types/webdriver/index.html><code>keyboard_types</code></a> crate, which made my part of the implementation straightforward. Unfortunately, this was not the case with <a href=https://w3c.github.io/webdriver/#pointer-actions>pointer actions</a>, which I had to fully implement from scratch.</p> <p>These weeks I got to contribute with some code changes to the <a href=https://crates.io/crates/webdriver><code>webdriver-rust</code></a> crate. This is the library that is used by both Servo and Firefox for creating and running the WebDriver server and processing the commands' arguments.</p> <p>One thing that I've done is <a href=https://hg.mozilla.org/mozilla-central/rev/827775bba76d>implement</a> the <code>Deserialize</code> trait for <code>ErrorStatus</code>. In Servo, the communication between the browser and the WebDriver server is done by means of <a href=https://github.com/servo/ipc-channel><code>ipc-channel</code></a>. This uses <a href=https://crates.io/crates/serde><code>serde</code></a> for serializing and deserializing the data that is passed over the channel. At the moment, we have no good way of propagating the errors that occur in the browser side back to the WebDriver server, so we just return an error with an empty body. This is problematic as we have a lot of WebDriver related functionality implemented in the browser side and a lot of different errors could occur there. Having the <code>Deserialize</code> trait implemented for <code>ErrorStatus</code> fixes this issue and makes for a more <a href=https://w3c.github.io/webdriver>spec</a> compliant implementation.</p> <p>Another thing that I've worked on is make the <a href=https://w3c.github.io/webdriver/#input-sources-0>input source</a>'s <code>id</code> field mandatory, as per the <a href=https://w3c.github.io/webdriver>spec</a>. Initially, this field had a type of <code>Option&lt;String></code> and, when <a href=https://w3c.github.io/webdriver/#processing-actions>processing</a> an action sequence, it was allowed to be either <code>undefined</code> or even inexistent. This was not <a href=https://w3c.github.io/webdriver>spec</a> compliant, as it is clearly <a href=https://w3c.github.io/webdriver/#dfn-process-an-input-source-action-sequence>specified</a> that the <code>id</code> property must be valid a <code>String</code>. <a href=https://hg.mozilla.org/mozilla-central/rev/fff7b5299ecf>Fixing</a> this was quite easy. As part of it I also added a <a href=https://github.com/web-platform-tests/wpt><code>wpt</code></a> test.</p> <p>These weeks I also started to work on the <a href=https://w3c.github.io/webdriver/#take-element-screenshot><code>TakeElementScreenshot</code></a> command. Currently, I'm blocked on <a href=https://w3c.github.io/webdriver/#dfn-draw-a-bounding-box-from-the-framebuffer><code>drawing a bounding box from the frame buffer</code></a>, more specifically on the sixth step that consists of drawing the element's rectangle onto a <a href=https://www.w3.org/TR/2dcontext/ >2D canvas context</a>, but with a little help I'll hopefully get it done. As part of this I identified another <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1571305">issue</a> in <a href=https://www.w3.org/TR/2dcontext/ ><code>webdriver-rust</code></a>: it misses the optional <code>scroll</code> parameter that specifies whether the element that is screenshotted will be scrolled into view or not.</p> <p>Following my <a href=https://docs.google.com/document/d/1iovWUZgo76r66tQBNZzkvWp7tcbE4Dei_3F8fnTBIXw/edit>proposal</a> I will now focus on implementing a <a href=https://web-platform-tests.org/writing-tests/testdriver.html><code>testdriver.js</code></a> backend. Besides this, I'm planning to get the previous work on <a href=https://w3c.github.io/webdriver/#actions>actions</a> reviewed and merged into the main branch.</p> <p>Sometimes, things don't work out as expected, as is the case with the <a href=https://github.com/servo/servo/pull/23725>PR</a> for returning arrays from <code>ExecuteScript</code>. It's still pending as there is a small issue with a particular test that seems to fail suspiciously on <a href=https://tools.taskcluster.net/groups/Sfd1306ARDirevbwP8Zn7g><code>TaskCluster</code></a>. Hopefully, that should get fixed soon.</p> <p>I managed to implement a good amount of new functionality in the last two weeks. Specifically, I really enjoyed my side contributions to <a href=https://crates.io/crates/webdriver><code>webdriver-rust</code></a> because I got to work with a different workflow than what I was used to.</p> <p>I'm looking forward to the next two weeks as I'm expecting to wrap up the work that was done in the previous weeks, getting ready for the end of GSoC!</p> </div></div></div></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{post:{title:"GSoC with Servo - weeks 9 and 10",date:"2019-08-05T00:00:00.000Z",slug:"gsoc-with-servo-weeks-9-and-10",html:"\n\u003Cp\u003ELast two weeks' focus was on finishing implementing the WebDriver \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#actions\"\u003Eactions\u003C\u002Fa\u003E commands.\nThese were the most challenging ones so far as there was no existing infrastructure in place as opposed to most of the other WebDriver commands.\nFor the \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#keyboard-actions\"\u003Ekeyboard actions\u003C\u002Fa\u003E most of the implementation was already provided by the\n\u003Ca href=\"https:\u002F\u002Fdocs.rs\u002Fkeyboard-types\u002F0.4.4\u002Fkeyboard_types\u002Fwebdriver\u002Findex.html\"\u003E\u003Ccode\u003Ekeyboard_types\u003C\u002Fcode\u003E\u003C\u002Fa\u003E crate, which made my part of the implementation straightforward.\nUnfortunately, this was not the case with \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#pointer-actions\"\u003Epointer actions\u003C\u002Fa\u003E, which I had to fully implement from scratch.\u003C\u002Fp\u003E\n\u003Cp\u003EThese weeks I got to contribute with some code changes to the \u003Ca href=\"https:\u002F\u002Fcrates.io\u002Fcrates\u002Fwebdriver\"\u003E\u003Ccode\u003Ewebdriver-rust\u003C\u002Fcode\u003E\u003C\u002Fa\u003E crate.\nThis is the library that is used by both Servo and Firefox for creating and running the WebDriver server and processing the commands' arguments.\u003C\u002Fp\u003E\n\u003Cp\u003EOne thing that I've done is \u003Ca href=\"https:\u002F\u002Fhg.mozilla.org\u002Fmozilla-central\u002Frev\u002F827775bba76d\"\u003Eimplement\u003C\u002Fa\u003E the \u003Ccode\u003EDeserialize\u003C\u002Fcode\u003E trait for \u003Ccode\u003EErrorStatus\u003C\u002Fcode\u003E.\nIn Servo, the communication between the browser and the WebDriver server is done by means of \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fipc-channel\"\u003E\u003Ccode\u003Eipc-channel\u003C\u002Fcode\u003E\u003C\u002Fa\u003E.\nThis uses \u003Ca href=\"https:\u002F\u002Fcrates.io\u002Fcrates\u002Fserde\"\u003E\u003Ccode\u003Eserde\u003C\u002Fcode\u003E\u003C\u002Fa\u003E for serializing and deserializing the data that is passed over the channel.\nAt the moment, we have no good way of propagating the errors that occur in the browser side back to the WebDriver server, so we just return an error\nwith an empty body.\nThis is problematic as we have a lot of WebDriver related functionality implemented in the browser side and a lot of different errors could occur there.\nHaving the \u003Ccode\u003EDeserialize\u003C\u002Fcode\u003E trait implemented for \u003Ccode\u003EErrorStatus\u003C\u002Fcode\u003E fixes this issue and makes for a more \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\"\u003Espec\u003C\u002Fa\u003E compliant implementation.\u003C\u002Fp\u003E\n\u003Cp\u003EAnother thing that I've worked on is make the \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#input-sources-0\"\u003Einput source\u003C\u002Fa\u003E's \u003Ccode\u003Eid\u003C\u002Fcode\u003E field mandatory, as per the \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\"\u003Espec\u003C\u002Fa\u003E.\nInitially, this field had a type of \u003Ccode\u003EOption&lt;String&gt;\u003C\u002Fcode\u003E and, when \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#processing-actions\"\u003Eprocessing\u003C\u002Fa\u003E an action sequence,\nit was allowed to be either \u003Ccode\u003Eundefined\u003C\u002Fcode\u003E or even inexistent.\nThis was not \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\"\u003Espec\u003C\u002Fa\u003E compliant, as it is clearly \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#dfn-process-an-input-source-action-sequence\"\u003Especified\u003C\u002Fa\u003E\nthat the \u003Ccode\u003Eid\u003C\u002Fcode\u003E property must be valid a \u003Ccode\u003EString\u003C\u002Fcode\u003E.\n\u003Ca href=\"https:\u002F\u002Fhg.mozilla.org\u002Fmozilla-central\u002Frev\u002Ffff7b5299ecf\"\u003EFixing\u003C\u002Fa\u003E this was quite easy. As part of it I also added a \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fweb-platform-tests\u002Fwpt\"\u003E\u003Ccode\u003Ewpt\u003C\u002Fcode\u003E\u003C\u002Fa\u003E test.\u003C\u002Fp\u003E\n\u003Cp\u003EThese weeks I also started to work on the \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#take-element-screenshot\"\u003E\u003Ccode\u003ETakeElementScreenshot\u003C\u002Fcode\u003E\u003C\u002Fa\u003E command.\nCurrently, I'm blocked on \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#dfn-draw-a-bounding-box-from-the-framebuffer\"\u003E\u003Ccode\u003Edrawing a bounding box from the frame buffer\u003C\u002Fcode\u003E\u003C\u002Fa\u003E,\nmore specifically on the sixth step that consists of drawing the element's rectangle onto a \u003Ca href=\"https:\u002F\u002Fwww.w3.org\u002FTR\u002F2dcontext\u002F\"\u003E2D canvas context\u003C\u002Fa\u003E, but with a little help I'll hopefully get it done.\nAs part of this I identified another \u003Ca href=\"https:\u002F\u002Fbugzilla.mozilla.org\u002Fshow_bug.cgi?id=1571305\"\u003Eissue\u003C\u002Fa\u003E in \u003Ca href=\"https:\u002F\u002Fwww.w3.org\u002FTR\u002F2dcontext\u002F\"\u003E\u003Ccode\u003Ewebdriver-rust\u003C\u002Fcode\u003E\u003C\u002Fa\u003E:\nit misses the optional \u003Ccode\u003Escroll\u003C\u002Fcode\u003E parameter that specifies whether the element that is screenshotted will be scrolled into view or not.\u003C\u002Fp\u003E\n\u003Cp\u003EFollowing my \u003Ca href=\"https:\u002F\u002Fdocs.google.com\u002Fdocument\u002Fd\u002F1iovWUZgo76r66tQBNZzkvWp7tcbE4Dei_3F8fnTBIXw\u002Fedit\"\u003Eproposal\u003C\u002Fa\u003E I will now focus on implementing\na \u003Ca href=\"https:\u002F\u002Fweb-platform-tests.org\u002Fwriting-tests\u002Ftestdriver.html\"\u003E\u003Ccode\u003Etestdriver.js\u003C\u002Fcode\u003E\u003C\u002Fa\u003E backend.\nBesides this, I'm planning to get the previous work on \u003Ca href=\"https:\u002F\u002Fw3c.github.io\u002Fwebdriver\u002F#actions\"\u003Eactions\u003C\u002Fa\u003E reviewed and merged into the main branch.\u003C\u002Fp\u003E\n\u003Cp\u003ESometimes, things don't work out as expected, as is the case with the \u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fservo\u002Fservo\u002Fpull\u002F23725\"\u003EPR\u003C\u002Fa\u003E for returning arrays from \u003Ccode\u003EExecuteScript\u003C\u002Fcode\u003E.\nIt's still pending as there is a small issue with a particular test that seems to fail suspiciously on \u003Ca href=\"https:\u002F\u002Ftools.taskcluster.net\u002Fgroups\u002FSfd1306ARDirevbwP8Zn7g\"\u003E\u003Ccode\u003ETaskCluster\u003C\u002Fcode\u003E\u003C\u002Fa\u003E.\nHopefully, that should get fixed soon.\u003C\u002Fp\u003E\n\u003Cp\u003EI managed to implement a good amount of new functionality in the last two weeks.\nSpecifically, I really enjoyed my side contributions to \u003Ca href=\"https:\u002F\u002Fcrates.io\u002Fcrates\u002Fwebdriver\"\u003E\u003Ccode\u003Ewebdriver-rust\u003C\u002Fcode\u003E\u003C\u002Fa\u003E because I got to work with a different workflow than what I was used to.\u003C\u002Fp\u003E\n\u003Cp\u003EI'm looking forward to the next two weeks as I'm expecting to wrap up the work that was done in the previous weeks, getting ready for the end of GSoC!\u003C\u002Fp\u003E\n"}}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.e5726ad4.js"}catch(e){main="/client/legacy/client.326a6068.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 